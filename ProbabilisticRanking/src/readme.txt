Made some modifications from lucene demo code.
